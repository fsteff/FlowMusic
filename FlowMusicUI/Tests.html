<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>FlowMusic QUnit Tests</title>
    <link rel="stylesheet" href="https://code.jquery.com/qunit/qunit-2.3.0.css">
</head>
<body>
<div id="qunit"></div>
<div id="qunit-fixture"></div>
<script src="https://code.jquery.com/qunit/qunit-2.3.0.js"></script>
<script src="./lib/jquery-1.12.0.min.js"></script>

<script src="./js/models/LocalComm.js"></script>
<script src="./js/models/Player.js"></script>
<script src="./js/models/Central.js"></script>
<script src="./js/models/PluginBase.js"></script>

<script src="./js/views/PlayBar.js"></script>
<script src="./js/views/SidePanel.js"></script>
<script src="./js/views/MainView.js"></script>
<script src="./js/views/PageView.js"></script>

<script src="./js/main.js"></script>
<script>
    QUnit.test("Constructors", function (assert) {
        var player = Central.getPlayer();
        var search = Central.getSearch();
        assert.ok(player instanceof MusicPlayer, "MusicPlayer");
        assert.ok(search instanceof SearchEngine, "SearchEngine");

        var pq = player.getPlayQueue();
        assert.ok(pq instanceof PlayQueue, "PlayQueue");
    });

    QUnit.test("PlayQueue", function (assert) {
        var pq = Central.getPlayer().getPlayQueue();
        pq.add({
            artist: "artist1",
            title: "title1",
            plugin: "noplugin",
            source: "nosource"
        });

        assert.equal(pq.current().artist, "artist1", "Add to empty");

        pq.add([{
            artist: "artist2",
            title: "title2",
            plugin: "noplugin",
            source: "nosource"
        }, {
            artist: "artist3",
            title: "title3",
            plugin: "noplugin",
            source: "nosource"
        }]);

        assert.equal(pq.songs[1].artist, "artist2", "Add multiple");
        var act;
        for (var i = 2; i < 5; i++) {
            act = pq.next(false);
            assert.equal(act.artist, "artist" + (((i - 1) % 3) + 1), "Next song (" + (i - 2) + ")");
        }

        const listener = function (actual) {
            act = actual;
        }

        pq.addListener(listener);

        pq.next(false);
        assert.equal(act.artist, "artist2", "Add Listener");

        pq.removeListener(listener);
        pq.next(false);
        assert.equal(act.artist, "artist2", "Remove Listener");


        act = pq.prev();
        assert.equal(act.artist, "artist2", "Previous");

        act = pq.playSong({artist:"artist1",title:"title1"});
        assert.equal(act.artist, "artist1", "playSong");


    });

</script>
</body>
</html>
